{"version":3,"sources":["node_modules/browser-pack/_prelude.js","primo-explore/custom/UCA/js/main.js","primo-explore/custom/UCA/js/prmBriefResultAfter/kohaItemsAvailability.js","primo-explore/custom/UCA/js/prmOpacAfter/kohaItemsTable.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","app","angular","config","$sceDelegateProvider","urlWhitelist","resourceUrlWhitelist","push","constant","_UCA_CAS","_koha_prod","_koha_preprod","_testbiblibre_koha_api_public","_testbiblibre_koha_api_privee","_preprod_koha_api_public","_preprod_koha_api_privee","_local_koha_primo_middleware","_devscd_koha_primo_middleware","_prodscd_koha_primo_middleware","component","bindings","parentCtrl","controller","this","$onInit","head","document","getElementsByTagName","script","createElement","type","src","appendChild","templateUrl","run","$templateCache","put","$scope","$http","$element","URLs","toplevel","sourceid","sourcerecordid","url","$ctrl","item","kohaDisplay","obj","pnx","display","facets","control","includes","headers","Content-Type","X-From-ExL-API-Gateway","undefined","method","cache","then","response","parent","children","style","items","data","record_type","biblio_id","catch","elems","element","querySelectorAll","index","$rootScope","self","scope","rootScope","userData","$$childHead","userSessionManagerService","console","log","userIsGuest","isGuest","reservationUrl","open","window"],"mappings":"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","file":"custom.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import {kohaItemsAvailability} from './prmBriefResultAfter/kohaItemsAvailability';\nimport {kohaItemsTable} from './prmOpacAfter/kohaItemsTable';\n\n    let app = angular.module('viewCustom', ['angularLoad', 'kohaItemsAvailability', 'kohaItemsTable']);\n\n    /****************************************************************************************************/\n\n        /*In case of CENTRAL_PACKAGE - comment out the below line to replace the other module definition*/\n\n        /*var app = angular.module('centralCustom', ['angularLoad']);*/\n\n    /****************************************************************************************************/\n\n  //factory pour requête API\n  app.config(['$sceDelegateProvider', function ($sceDelegateProvider) {\n      let urlWhitelist = $sceDelegateProvider.resourceUrlWhitelist();\n      urlWhitelist.push('http://catalogue.unice.fr:1701**',\n                        'http://catalogue.unice.fr**',\n                        'https://demo.biblibre.com**',\n                        'https://pro-bu-cotedazur-koha.preprod.biblibre.eu**',\n                        'https://catalogue-bu-cotedazur-koha.preprod.biblibre.eu**',\n                        'https://api.archives-ouvertes.fr**',\n                        'https://books.google.com**',\n                        'http://books.google.com**',\n                        'https://bu.univ-cotedazur.fr**',\n                        'http://localhost:8003**',\n                        'https://localhost:5000**',\n                        'http://dev-scd.unice.fr**',\n                        'https://api-scd.univ-cotedazur.fr**');\n      $sceDelegateProvider.resourceUrlWhitelist(urlWhitelist);\n    }])\n\n      app.constant('URLs', {\n        _UCA_CAS: 'https://login.unice.fr/login?service=',\n        _koha_prod: 'https://catalogue-bu-univ-cotedazur.biblibre.fr',\n        _koha_preprod: 'https://catalogue-bu-cotedazur-koha.preprod.biblibre.eu',\n        _testbiblibre_koha_api_public: 'https://demo.biblibre.com/api/v1/public/',\n        _testbiblibre_koha_api_privee: 'https://demo.biblibre.com/api/v1/',\n        _preprod_koha_api_public: 'https://catalogue-bu-cotedazur-koha.preprod.biblibre.eu/api/v1/public/',\n        _preprod_koha_api_privee: 'https://catalogue-bu-cotedazur-koha.preprod.biblibre.eu/api/v1/',\n        _local_koha_primo_middleware: 'https://localhost:5000/koha-primo-middleware/api/v1/koha/',\n        _devscd_koha_primo_middleware: 'http://dev-scd.unice.fr/koha-primo-middleware/api/v1/koha/',\n        _prodscd_koha_primo_middleware: 'https://api-scd.univ-cotedazur.fr/koha-primo-middleware/api/v1/koha/',\n    });\n\n// load jquery\napp.component('prmTopBarBefore', {\n  bindings: { parentCtrl: '<' },\n  controller: [function controller() {\n      this.$onInit = function() {\n        const url = \"https://code.jquery.com/jquery-3.6.3.min.js\"\n        const head = document.getElementsByTagName('head')[0];\n        const script = document.createElement('script');\n        script.type = 'text/javascript';\n        script.src = url;\n        head.appendChild(script);\n      };\n  }]\n});\n\n// matomo\napp.component('prmExploreMainAfter', {\n  templateUrl: 'custom/UCA/html/matomo.html'\n});\n\napp.run(['$templateCache', function($templateCache) {\n  $templateCache.put('components/search/fullView/getit/opac/locations/locations.html','<prm-uca-items-table-koha></prm-uca-items-table-koha>');\n}]);\n     /*if customDisplayExemplaire_without_module : \n       1. en-tête import {customDisplayExemplaireConfig} from './prmBriefResultAfter/customDisplayExemplaire';\n       2. enlever l'instanciation du module dans angular.module\n       3. ajouter app.component('prmBriefResultAfter', customDisplayExemplaireConfig);\n     */\n","angular.module('kohaItemsAvailability', []).controller('kohaItemsAvailabilityController', ['$scope', '$http', '$element', 'URLs', function ($scope, $http, $element, URLs) {\r\n    this.$onInit = function() {\r\n        if ($scope.$ctrl.parentCtrl.item) {\r\n             /*---koha display false----*/\r\n            $scope.kohaDisplay = false; \r\n            /*---bib record metadata---*/\r\n            let obj = $scope.$ctrl.parentCtrl.item.pnx;\r\n            let type = obj.display.type[0];\r\n            let toplevel = obj.facets.toplevel[0]\r\n            /*---Prod--------*/\r\n            let sourceid = obj.control.sourceid[0];\r\n            let sourcerecordid = obj.control.sourcerecordid[0]\r\n            /*-----End prod----------*/\r\n                /*---items from Koha---*/\r\n                if (sourceid.includes(\"_KOHA\") && toplevel != 'online_resources') {\r\n                //var url = URLs._preprod_koha_api_public + \"biblios/\" + sourcerecordid.toString() +\"/items\";\r\n                let url = URLs._prodscd_koha_primo_middleware + \"biblios_items/\" + sourcerecordid\r\n                $http({\r\n                    \"headers\": {\r\n                        'Content-Type': 'application/json',\r\n                        'X-From-ExL-API-Gateway': undefined\r\n                    },\r\n                    method: 'GET',\r\n                    //jsonpCallbackParam: 'callback',\r\n                    url: url,\r\n                    cache: true,\r\n                }).then(function (response) {\r\n                    //console.log(response.data)\r\n                    /*---koha display true----*/\r\n                    $scope.kohaDisplay = true\r\n                    /*---hide div.search-result-availability-line-wrapper ----*/\r\n                    $element.parent().parent().children()[3].style.display = \"none\"\r\n                    /*--- get koha API item metadata ---*/\r\n                    $scope.items = response.data\r\n                    $scope.record_type = type\r\n                    $scope.biblio_id = sourcerecordid\r\n                }).catch(function(response){\r\n                     // error \r\n                     var elems = angular.element(document.querySelectorAll('.search-result-availability-line-wrapper'));\r\n                     var index = 0,\r\n                         length = elems.length;\r\n                     for (; index < length; index++) {\r\n                         elems[index].style.display = 'block';\r\n                     }\r\n                     var elems = angular.element(document.querySelectorAll('prm-brief-result-container prm-search-result-availability-line>*:not(:nth-last-child(1))'));\r\n                     var index = 0,\r\n                         length = elems.length;\r\n                     for (; index < length; index++) {\r\n                         elems[index].style.display = 'block';\r\n                     }\r\n                })        \r\n            }\r\n\r\n        }\r\n    }\r\n}]).component('prmBriefResultAfter', {\r\n\t  bindings: {parentCtrl: '<'},\r\n    controller: 'kohaItemsAvailabilityController',\r\n    templateUrl: 'custom/UCA/html/prmBriefResultAfter.html'\r\n  });\r\n","angular.module('kohaItemsTable', []).controller('kohaItemsTableController', ['$scope', '$rootScope' ,'$http','URLs', function ($scope, $rootScope, $http,URLs) {\r\n    this.$onInit = function() {\r\n        if ($scope.$ctrl.parentCtrl.item) {\r\n            /* --- user ---*/\r\n            let self = this;\r\n            self.scope = $scope;\r\n            self.rootScope = $rootScope;\r\n            let userData = self.rootScope.$$childHead.$ctrl.userSessionManagerService;\r\n            console.log(userData)\r\n            $scope.userIsGuest = userData.isGuest();\r\n            /*--- items ---*/\r\n            let obj = $scope.$ctrl.parentCtrl.item.pnx;\r\n            let type = obj.display.type[0];\r\n            let toplevel = obj.facets.toplevel[0]\r\n            /*---Prod--------*/\r\n            let sourceid = obj.control.sourceid[0];\r\n            let sourcerecordid = obj.control.sourcerecordid[0]\r\n            /*-----End prod----------*/\r\n                       /*---items from Koha---*/\r\n                       if (sourceid.includes(\"_KOHA\") && toplevel != 'online_resources') {\r\n                        let url = URLs._prodscd_koha_primo_middleware + \"biblios_items/\" + sourcerecordid\r\n                        $http({\r\n                            \"headers\": {\r\n                                'Content-Type': 'application/json',\r\n                                'X-From-ExL-API-Gateway': undefined\r\n                            },\r\n                            method: 'GET',\r\n                            //jsonpCallbackParam: 'callback',\r\n                            url: url,\r\n                            cache: true,\r\n                        }).then(function (response) {\r\n                            console.log(response.data)\r\n                            $scope.items = response.data\r\n                            $scope.record_type = type\r\n                            $scope.biblio_id = sourcerecordid\r\n                            let reservationUrl = URLs._UCA_CAS + URLs._koha_prod +\"/cgi-bin/koha/opac-reserve.pl?biblionumber=\" + sourcerecordid\r\n                            $scope.open = function () {\r\n                                window.open( reservationUrl, \"_system\"); \r\n                                return false;\r\n                            }\r\n                        });\r\n                    }\r\n\r\n        }\r\n    }\r\n}]).component('prmOpacAfter', {\r\n\t  bindings: {parentCtrl: '<'},\r\n    controller: 'kohaItemsTableController',\r\n    templateUrl: 'custom/UCA/html/prmOpacAfter.html'\r\n  });"]}