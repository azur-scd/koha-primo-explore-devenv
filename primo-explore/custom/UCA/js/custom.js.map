{"version":3,"sources":["node_modules/browser-pack/_prelude.js","primo-explore/custom/UCA/js/customServices/kohaServices.js","primo-explore/custom/UCA/js/customServices/shareDataService.js","primo-explore/custom/UCA/js/main.js","primo-explore/custom/UCA/js/prmBriefResultAfter/kohaItemsAvailability.js","primo-explore/custom/UCA/js/prmOpacAfter/kohaItemsTable.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","angular","factory","$http","$q","KOHA_MIDDLEWARE_URL","kohaData","koha_ids","url","_api","headers","Content-Type","X-From-ExL-API-Gateway","undefined","method","cache","then","response","data","pnxData","obj","type","display","toplevels","facets","toplevel","sourceids","control","sourceid","sourcerecordid","some","x","includes","filter","item","map","split","toString","app","config","$sceDelegateProvider","urlWhitelist","resourceUrlWhitelist","push","constant","_UCA_CAS","_local_koha_primo_middleware","_devscd_koha_primo_middleware","_prodscd_koha_primo_middleware","provider","URLs","this","$get","component","bindings","parentCtrl","controller","$onInit","head","document","getElementsByTagName","script","createElement","src","appendChild","templateUrl","template","$scope","kohaItemDataService","pnxShareDataService","$ctrl","kohaDisplay","pnx","console","log","successResponse","items","elems","element","querySelectorAll","index","querySelector","style","record_type","$rootScope","kohaTableDisplay","scope","rootScope","userData","$$childHead","userSessionManagerService","userIsGuest","isGuest","biblio_id","resa","resa_button","reservationUrl","_koha_prod","open","window"],"mappings":"AAAA,CAAA,SAAAA,EAAAC,EAAAC,EAAAC,GAAA,SAAAC,EAAAC,EAAAC,GAAA,GAAA,CAAAJ,EAAAG,GAAA,CAAA,GAAA,CAAAJ,EAAAI,GAAA,CAAA,IAAAE,EAAA,YAAA,OAAAC,SAAAA,QAAA,GAAA,CAAAF,GAAAC,EAAA,OAAAA,EAAAF,EAAA,CAAA,CAAA,EAAA,GAAAI,EAAA,OAAAA,EAAAJ,EAAA,CAAA,CAAA,EAAA,MAAAK,EAAA,IAAAC,MAAA,uBAAAN,EAAA,GAAA,GAAAO,KAAA,mBAAAF,CAAA,CAAAG,EAAAX,EAAAG,GAAA,CAAAS,QAAA,EAAA,EAAAb,EAAAI,GAAA,GAAAU,KAAAF,EAAAC,QAAA,SAAAd,GAAA,OAAAI,EAAAH,EAAAI,GAAA,GAAAL,IAAAA,CAAA,CAAA,EAAAa,EAAAA,EAAAC,QAAAd,EAAAC,EAAAC,EAAAC,CAAA,CAAA,CAAA,OAAAD,EAAAG,GAAAS,OAAA,CAAA,IAAA,IAAAL,EAAA,YAAA,OAAAD,SAAAA,QAAAH,EAAA,EAAAA,EAAAF,EAAAa,OAAAX,CAAA,GAAAD,EAAAD,EAAAE,EAAA,EAAA,OAAAD,CAAA,EAAA,CAAAa,EAAA,CAAA,SAAAT,EAAAU,EAAAJ,G,aCAAK,QAAQD,OAAO,eAAgB,EAA/B,EAAmCE,QAAQ,sBAAuB,CAAC,QAAS,KAAM,sBAAuB,SAAUC,EAAOC,EAAIC,GAC5H,MAAO,CACLC,SAAU,SAAUC,GACdC,EAAMH,EAAoBI,KAAO,4BAA8BF,EACnE,OAAOJ,EAAM,CACXO,QAAW,CACTC,eAAgB,mBAChBC,yBAA0BC,KAAAA,CAFjB,EAIXC,OAAQ,MACRN,IAAKA,EACLO,MAAO,CAAA,CAPI,CAAN,EAQJC,KAAK,SAAUC,GAChB,OAAOA,EAASC,IACjB,CAVM,CAWR,CAdI,CA+BR,EAhCD,C,sCCAAjB,QAAQD,OAAO,mBAAoB,EAAnC,EAAuCE,QAAQ,sBAAuB,CAAC,WACnE,MAAO,CACHiB,QAAS,SAAUC,GAEf,IAEIC,EAAOD,EAAIE,QAAQD,KAAK,GACxBE,EAAYH,EAAII,OAAOC,SAEvBC,EAAYN,EAAIO,QAAQC,SACxBC,EAAiBT,EAAIO,QAAQE,eAAe,GAEhD,GAAGH,EAAUI,KAAK,SAAAC,GAAA,OAAKA,EAAEC,SAAS,OAAX,CAAL,CAAf,GAA4CT,EAAUS,SAAS,WAAnB,EAU/C,MAAO,CACHX,KAASA,EACTd,SAXsB,EAAnBmB,EAAU5B,OACE4B,EACVO,OAAO,SAAAC,GAAA,OAAQA,EAAKF,SAAS,OAAd,CAAR,CADG,EAEVG,IAAI,SAAAJ,GAAA,OAAKA,EAAEK,MAAM,eAAR,EAAyB,EAA9B,CAFM,EAGVC,SAHU,EAMAR,CAEZ,CAKZ,CA1BI,CA4BV,EA7BD,C,sCCAAvC,EAAA,6CAAA,EACAA,EAAA,+BAAA,EAEIgD,EAAMrC,QAAQD,OAAO,aAAc,CAAC,cAAe,wBAAyB,iBAAtE,EAWVsC,EAAIC,OAAO,CAAC,uBAAwB,SAAUC,GAC5C,IAAIC,EAAeD,EAAqBE,qBAArB,EACnBD,EAAaE,KAAK,mCAChB,8BACA,8BACA,sDACA,4DACA,qCACA,6BACA,4BACA,iCACA,0BACA,2BACA,4BACA,qCAZF,EAaAH,EAAqBE,qBAAqBD,CAA1C,CACD,EAhBD,EAmBAH,EAAIM,SAAS,OAAQ,CACnBC,SAAU,wCAOVC,6BAA8B,4DAC9BC,8BAA+B,6DAC/BC,+BAAgC,sEAVb,CAArB,EAaAV,EAAIW,SAAS,sBAAuB,CAAC,OAAQ,SAAUC,GACrDC,KAAKC,KAAO,WACV,MAAO,CACL3C,KAAMyC,EAAKJ,4BADN,CAGR,CACF,EAND,EASAR,EAAIe,UAAU,kBAAmB,CAC/BC,SAAU,CAAEC,WAAY,GAAd,EACVC,WAAY,CAAC,WACXL,KAAKM,QAAU,WACb,IACMC,EAAOC,SAASC,qBAAqB,MAA9B,EAAsC,GAC7CC,EAASF,SAASG,cAAc,QAAvB,EACfD,EAAOxC,KAAO,kBACdwC,EAAOE,IAJK,8CAKZL,EAAKM,YAAYH,CAAjB,CACD,CACF,EAX8B,CAAjC,EAeAvB,EAAIe,UAAU,sBAAuB,CACnCC,SAAU,CAACC,WAAY,GAAb,EACVU,YAAa,6BAFsB,CAArC,EAMA3B,EAAIe,UAAU,oBAAqB,CACjCC,SAAU,CAACC,WAAY,GAAb,EACVW,SAAU,mZAFuB,CAAnC,C,uHC3EA5E,EAAA,gCAAA,EACAA,EAAA,oCAAA,EAEAW,QAAQD,OAAO,wBAAyB,CAAC,eAAgB,mBAAzD,EAA8EwD,WAAW,kCAAmC,CAAC,SAAU,sBAAuB,sBAAuB,SAAUW,EAAQC,EAAqBC,GACxNlB,KAAKM,QAAU,WACX,IAIQrC,EAEAF,EANJiD,EAAOG,MAAMf,WAAWrB,OAExBiC,EAAOI,YAAc,CAAA,EAEjBnD,EAAM+C,EAAOG,MAAMf,WAAWrB,KAAKsC,IACvCC,QAAQC,IAAItD,CAAZ,GACIF,EAAOmD,EAAoBlD,QAAQC,CAA5B,GAGPgD,EAAoB9D,SAASY,EAAKX,QAAlC,EAA4CS,KAAK,SAAU2D,GACvDR,EAAOS,MAAQD,EAAgBC,MAE/BT,EAAOI,YAAc,CAAA,EAErB,IAAIM,EAAQ5E,QAAQ6E,QAAQnB,SAASoB,iBAAiB,mIAA1B,CAAhB,EAEZjF,OAAS+E,EAAM/E,OACf,IAAK,IAAIkF,EAAQ,EAAGA,EAAQlF,OAAQkF,CAAA,GAE7BH,EAAMG,GAAOC,cAAc,qCAA3B,IACHJ,EAAMG,GAAOE,MAAM5D,QAAU,QAGjC6C,EAAOgB,YAAcjE,EAAKG,IAE7B,CAhBD,EAmBA8C,EAAOI,YAAc,CAAA,EAIhC,CACJ,EAnCD,EAmCIlB,UAAU,sBAAuB,CACjCC,SAAU,CAAEC,WAAY,GAAd,EACVC,WAAY,kCACZS,YAAa,0CAHoB,CAnCrC,C,+GCJA3E,EAAA,gCAAA,EACAA,EAAA,oCAAA,EAEAW,QAAQD,OAAO,iBAAkB,CAAC,eAAgB,mBAAlD,EAAuEwD,WAAW,2BAA4B,CAAC,SAAU,aAAc,OAAQ,sBAAuB,sBAAuB,SAAUW,EAAQiB,EAAYlC,EAAMkB,EAAqBC,GAClPlB,KAAKM,QAAU,WACX,IAWQrC,EACAF,EAZJiD,EAAOG,MAAMf,WAAWrB,OAExBiC,EAAOkB,iBAAmB,CAAA,EAEflC,KACNmC,MAAQnB,EADFhB,KAENoC,UAAYH,EACbI,EAHOrC,KAGSoC,UAAUE,YAAYnB,MAAMoB,0BAChDvB,EAAOwB,YAAcH,EAASI,QAAT,EACrBnB,QAAQC,IAAIP,CAAZ,EAEI/C,EAAM+C,EAAOG,MAAMf,WAAWrB,KAAKsC,KACnCtD,EAAOmD,EAAoBlD,QAAQC,CAA5B,GAGPgD,EAAoB9D,SAASY,EAAKX,QAAlC,EAA4CS,KAAK,SAAU2D,GACvDR,EAAOS,MAAQD,EAAgBC,MAC/BT,EAAO0B,UAAY1B,EAAOS,MAAM,GAAb,UACnBT,EAAO2B,KAAOnB,EAAgBoB,YAE9B5B,EAAOkB,iBAAmB,CAAA,EAE1BpF,QAAQ6E,QAAQnB,SAASsB,cAAc,kBAAvB,CAAhB,EAA4D,GAAGC,MAAM5D,QAAU,OAE/E6C,EAAOgB,YAAcjE,EAAKG,KAC1B,IAAI2E,EAAiB9C,EAAKL,SAAWK,EAAK+C,WAAa,8CAAgD9B,EAAO0B,UAC9G1B,EAAO+B,KAAO,WAEV,OADAC,OAAOD,KAAKF,EAAgB,SAA5B,EACO,CAAA,CACV,CACJ,CAfD,EAmBA7B,EAAOkB,iBAAmB,CAAA,EAGrC,CACJ,EAxCD,EAwCIhC,UAAU,eAAgB,CAC1BC,SAAU,CAAEC,WAAY,GAAd,EACVC,WAAY,2BACZS,YAAa,mCAHa,CAxC9B","file":"custom.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","angular.module('kohaServices', []).factory('kohaItemDataService', ['$http', '$q', 'KOHA_MIDDLEWARE_URL', function ($http, $q, KOHA_MIDDLEWARE_URL) {\r\n  return {\r\n    kohaData: function (koha_ids) {\r\n      let url = KOHA_MIDDLEWARE_URL._api + \"biblios_items?biblio_ids=\" + koha_ids\r\n      return $http({\r\n        \"headers\": {\r\n          'Content-Type': 'application/json',\r\n          'X-From-ExL-API-Gateway': undefined\r\n        },\r\n        method: 'GET',\r\n        url: url,\r\n        cache: true,\r\n      }).then(function (response) {\r\n        return response.data;\r\n      });\r\n    }\r\n  }\r\n\r\n  /*this.getKohaData = function (sourcerecordid) {\r\n    let url = KOHA_MIDDLEWARE_URL._api + \"biblios_items/\" + sourcerecordid\r\n    $http({\r\n        \"headers\": {\r\n            'Content-Type': 'application/json',\r\n            'X-From-ExL-API-Gateway': undefined\r\n        },\r\n        method: 'GET',\r\n        url: url,\r\n        cache: true,\r\n    }).then(function (response) {\r\n      return response.data;\r\n    });\r\n  }*/\r\n}]);","angular.module('shareDataService', []).factory('pnxShareDataService', [function () {\r\n    return {\r\n        pnxData: function (obj) {\r\n            /*--- init ----*/\r\n            let koha_ids;\r\n            /*---bib record metadata---*/\r\n            let type = obj.display.type[0];\r\n            let toplevels = obj.facets.toplevel\r\n            /*---bib record identifers --------*/\r\n            let sourceids = obj.control.sourceid;\r\n            let sourcerecordid = obj.control.sourcerecordid[0]\r\n            /*---apply rules to get valid Koha biblio_id numbers --------*/\r\n            if(sourceids.some(x => x.includes(\"_KOHA\")) && toplevels.includes(\"available\")) {\r\n                if(sourceids.length > 1) {\r\n                    koha_ids = sourceids\r\n                    .filter(item => item.includes(\"_KOHA\"))\r\n                    .map(x => x.split(\"$$O33UCA_KOHA\")[1])\r\n                    .toString()\r\n                }\r\n                else {\r\n                    koha_ids = sourcerecordid\r\n                }\r\n            return {\r\n                \"type\" : type,\r\n                \"koha_ids\": koha_ids\r\n              }\r\n        }\r\n      }\r\n    }\r\n}]);","import { kohaItemsAvailability } from './prmBriefResultAfter/kohaItemsAvailability';\nimport { kohaItemsTable } from './prmOpacAfter/kohaItemsTable';\n\nlet app = angular.module('viewCustom', ['angularLoad', 'kohaItemsAvailability', 'kohaItemsTable']);\n\n/****************************************************************************************************/\n\n/*In case of CENTRAL_PACKAGE - comment out the below line to replace the other module definition*/\n\n/*var app = angular.module('centralCustom', ['angularLoad']);*/\n\n/****************************************************************************************************/\n\n//factory pour requête API\napp.config(['$sceDelegateProvider', function ($sceDelegateProvider) {\n  let urlWhitelist = $sceDelegateProvider.resourceUrlWhitelist();\n  urlWhitelist.push('http://catalogue.unice.fr:1701**',\n    'http://catalogue.unice.fr**',\n    'https://demo.biblibre.com**',\n    'https://pro-bu-cotedazur-koha.preprod.biblibre.eu**',\n    'https://catalogue-bu-cotedazur-koha.preprod.biblibre.eu**',\n    'https://api.archives-ouvertes.fr**',\n    'https://books.google.com**',\n    'http://books.google.com**',\n    'https://bu.univ-cotedazur.fr**',\n    'http://localhost:8003**',\n    'https://localhost:5000**',\n    'http://dev-scd.unice.fr**',\n    'https://api-scd.univ-cotedazur.fr**');\n  $sceDelegateProvider.resourceUrlWhitelist(urlWhitelist);\n}])\n\n//urls declaration\napp.constant('URLs', {\n  _UCA_CAS: 'https://login.unice.fr/login?service=',\n /* _koha_prod: 'https://catalogue-bu-univ-cotedazur.biblibre.fr',\n  _koha_preprod: 'https://catalogue-bu-cotedazur-koha.preprod.biblibre.eu',\n  _testbiblibre_koha_api_public: 'https://demo.biblibre.com/api/v1/public/',\n  _testbiblibre_koha_api_privee: 'https://demo.biblibre.com/api/v1/',\n  _preprod_koha_api_public: 'https://catalogue-bu-cotedazur-koha.preprod.biblibre.eu/api/v1/public/',\n  _preprod_koha_api_privee: 'https://catalogue-bu-cotedazur-koha.preprod.biblibre.eu/api/v1/',*/\n  _local_koha_primo_middleware: 'https://localhost:5000/koha-primo-middleware/api/v1/koha/',\n  _devscd_koha_primo_middleware: 'http://dev-scd.unice.fr/koha-primo-middleware/api/v0/koha/',\n  _prodscd_koha_primo_middleware: 'https://api-scd.univ-cotedazur.fr/koha-primo-middleware/api/v1/koha/',\n});\n\napp.provider('KOHA_MIDDLEWARE_URL', ['URLs', function (URLs) {\n  this.$get = function () {\n    return {\n      _api: URLs._local_koha_primo_middleware // pour passer en prod : remplacer par URLS. _prodscd_koha_primo_middleware\n    };\n  }\n}]);\n\n// load jquery\napp.component('prmTopBarBefore', {\n  bindings: { parentCtrl: '<' },\n  controller: [function controller() {\n    this.$onInit = function () {\n      const url = \"https://code.jquery.com/jquery-3.6.3.min.js\"\n      const head = document.getElementsByTagName('head')[0];\n      const script = document.createElement('script');\n      script.type = 'text/javascript';\n      script.src = url;\n      head.appendChild(script);\n    };\n  }]\n});\n\n// matomo\napp.component('prmExploreMainAfter', {\n  bindings: {parentCtrl: '<'},\n  templateUrl: 'custom/UCA/html/matomo.html'\n});\n\n// Bandeau information\napp.component('prmSearchBarAfter', {\n  bindings: {parentCtrl: '<'},\n  template: '<div class=\"bar custom-alert-bar layout-align-center-center layout-row\" layout=\"row\" layout-align=\"center center\"><b>Vacances d\\'été</b> : la <span style=\"margin-left:5px;margin-right:5px;\">navette interBU</span> est interrompue du 21 juillet au 21 août. <a href=\"https://bu.univ-cotedazur.fr/fr/contents/actualites/fermeture-estivale-des-bu-et-des-services\" target=\"_blanck\"> En savoir plus</a></div>'\n});\n\n/*\n[Unused] Init template for custom display of exemplaire\napp.run(['$templateCache', function($templateCache) {\n  $templateCache.put('components/search/fullView/getit/opac/locations/locations.html','<prm-uca-items-table-koha></prm-uca-items-table-koha>');\n}]);\n*/\n\n\n\n/*if customDisplayExemplaire_without_module : \n1. en-tête import {customDisplayExemplaireConfig} from './prmBriefResultAfter/customDisplayExemplaire';\n2. enlever l'instanciation du module dans angular.module\n3. ajouter app.component('prmBriefResultAfter', customDisplayExemplaireConfig);\n */\n","//import {customServices} from '/usr/src/app/primo-explore/custom/UCA/js/services';\r\nimport { kohaServices } from '../customServices/kohaServices';\r\nimport { shareDataService } from '../customServices/shareDataService';\r\n\r\nangular.module('kohaItemsAvailability', ['kohaServices', 'shareDataService']).controller('kohaItemsAvailabilityController', ['$scope', 'kohaItemDataService', 'pnxShareDataService', function ($scope, kohaItemDataService, pnxShareDataService) {\r\n    this.$onInit = function () {\r\n        if ($scope.$ctrl.parentCtrl.item) {\r\n            /*--- default : koha display false----*/\r\n            $scope.kohaDisplay = false;\r\n            /*---bib record metadata---*/\r\n            let obj = $scope.$ctrl.parentCtrl.item.pnx;\r\n            console.log(obj)\r\n            let data = pnxShareDataService.pnxData(obj)\r\n                if(data) {\r\n                /*---items from Koha---*/\r\n                kohaItemDataService.kohaData(data.koha_ids).then(function (successResponse) {\r\n                    $scope.items = successResponse.items;\r\n                    /*--- display custom koha items ----*/\r\n                    $scope.kohaDisplay = true\r\n                    /*---hide div.search-result-availability-line-wrapper if prm-icon is physical item----*/ \r\n                    let elems = angular.element(document.querySelectorAll('div.search-result-availability-line-wrapper > prm-search-result-availability-line > div.layout-align-start-start > div.layout-row'));\r\n                    //console.log(elems)\r\n                    length = elems.length;\r\n                    for (let index = 0; index < length; index++) {\r\n                       //console.log(elems[index])\r\n                       if (elems[index].querySelector('prm-icon[ng-if*=\"$ctrl.isPhysical\"]')) {\r\n                        elems[index].style.display = 'none';\r\n                       }\r\n                    }\r\n                    $scope.record_type = data.type\r\n\r\n                });\r\n            }\r\n            else {\r\n                $scope.kohaDisplay = false;\r\n            }\r\n\r\n        }\r\n    }\r\n}]).component('prmBriefResultAfter', {\r\n    bindings: { parentCtrl: '<' },\r\n    controller: 'kohaItemsAvailabilityController',\r\n    templateUrl: 'custom/UCA/html/prmBriefResultAfter.html'\r\n});\r\n","import { kohaServices } from '../customServices/kohaServices';\r\nimport { shareDataService } from '../customServices/shareDataService';\r\n\r\nangular.module('kohaItemsTable', ['kohaServices', 'shareDataService']).controller('kohaItemsTableController', ['$scope', '$rootScope', 'URLs', 'kohaItemDataService', 'pnxShareDataService', function ($scope, $rootScope, URLs, kohaItemDataService, pnxShareDataService) {\r\n    this.$onInit = function () {\r\n        if ($scope.$ctrl.parentCtrl.item) {\r\n            /*---default : kohaTable display false----*/\r\n            $scope.kohaTableDisplay = false;\r\n            /* --- to detect if user is logged or not -> displaying the connection button or not---*/\r\n            let self = this;\r\n            self.scope = $scope;\r\n            self.rootScope = $rootScope;\r\n            let userData = self.rootScope.$$childHead.$ctrl.userSessionManagerService;\r\n            $scope.userIsGuest = userData.isGuest();\r\n            console.log($scope)\r\n            /*--- bib record metadata ---*/\r\n            let obj = $scope.$ctrl.parentCtrl.item.pnx;\r\n            let data = pnxShareDataService.pnxData(obj)\r\n            if(data){\r\n                /*---items from Koha---*/\r\n                kohaItemDataService.kohaData(data.koha_ids).then(function (successResponse) {\r\n                    $scope.items = successResponse.items;\r\n                    $scope.biblio_id = $scope.items[0][\"biblio_id\"]\r\n                    $scope.resa = successResponse.resa_button;\r\n                    /*--- display custom koha items table ----*/\r\n                    $scope.kohaTableDisplay = true\r\n                    /*---hide native primo items table ----*/\r\n                    angular.element(document.querySelector('prm-opac>md-tabs'))[0].style.display = \"none\"\r\n                    /*----Réservation button----*/\r\n                    $scope.record_type = data.type\r\n                    let reservationUrl = URLs._UCA_CAS + URLs._koha_prod + \"/cgi-bin/koha/opac-reserve.pl?biblionumber=\" + $scope.biblio_id\r\n                    $scope.open = function () {\r\n                        window.open(reservationUrl, \"_system\");\r\n                        return false;\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                //if error, returns to native Primo display\r\n                $scope.kohaTableDisplay = false;\r\n            }\r\n        }\r\n    }\r\n}]).component('prmOpacAfter', {\r\n    bindings: { parentCtrl: '<' },\r\n    controller: 'kohaItemsTableController',\r\n    templateUrl: 'custom/UCA/html/prmOpacAfter.html'\r\n});"]}